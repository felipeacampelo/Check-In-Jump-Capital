{% extends 'adolescentes/base.html' %}
{% load static %}

{% block title %}Definir nova senha{% endblock %}

{% block extra_head %}
  <link rel="preload" as="image" href="{% static 'adolescentes/img/bg_definirsenha.jpg' %}">
{% endblock %}

{% block body_class %}d-flex flex-column min-vh-100{% endblock %}

{% block content %}
<style>
  html, body { height: 100%; background: #0b1320; }
  body { margin: 0; padding-top: 0 !important; }
  html, body { overflow-x: hidden; }
  main > .container { max-width: 100% !important; padding-left: 0 !important; padding-right: 0 !important; }
  .login-hero { position: relative; height: 100vh; width: 100vw; left: 50%; right: 50%; margin-left: -50vw; margin-right: -50vw; display: flex; align-items: center; justify-content: center; overflow: hidden; color: #fff; }
  .login-hero::before { content: ""; position: absolute; inset: 0; background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url("{% static 'adolescentes/img/bg_definirsenha.jpg' %}") center/cover no-repeat; filter: saturate(110%); z-index: 0; }
  .login-grid { position: relative; z-index: 1; width: 100%; }
  .welcome-panel { position: relative; color: #fff; padding: 3rem; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; overflow: hidden; }
  .top-left-logo { position: absolute; top: -36px; left: max(16px, calc(50% - 340px)); }
  .brand-logo-top { display: block; height: auto; width: auto; max-width: 240px; }
  .welcome-content { width: min(92%, 680px); margin: 0 auto; }
  .welcome-panel h1 { white-space: nowrap; }
  .right-pane { padding-top: 60px !important; }
  .login-card { z-index: 1; width: 100%; max-width: 400px; background: #ffffff; border: none; border-radius: 16px; box-shadow: 0 15px 35px rgba(0,0,0,0.35); overflow: hidden; }
  .login-card .card-header { background: transparent; border-bottom: none; text-align: center; padding: 1.5rem 1.5rem 0.5rem; }
  .login-card .card-body { padding: 1.5rem; }
  .form-floating>.form-control { height: calc(3.5rem + 2px); }
  .alert-login { border-radius: 10px; }
  @media (min-width: 992px) { .right-pane { display: flex; align-items: center; justify-content: center; min-height: 100vh; } }
  .login-copy { position: absolute; bottom: 16px; left: 50%; transform: translateX(-50%); color: #ffffff; opacity: .85; font-size: .9rem; z-index: 2; }
</style>

{% block navbar %}{% endblock %}

<section class="login-hero">
  <div class="login-grid container-fluid px-0">
    <div class="row g-0">
      <div class="col-lg-7 d-none d-lg-flex">
        <div class="welcome-panel">
          <div class="top-left-logo">
            <img src="{% static 'adolescentes/img/logo-white.png' %}" alt="Logo" class="brand-logo-top" />
          </div>
          <div class="welcome-content">
            <h1 class="display-5 mb-3 text-center">Recuperação de acesso</h1>
            <p>Defina uma nova senha para acessar o sistema.<br>O token expira em 24 horas.</p>
          </div>
        </div>
      </div>
      <div class="col-12 col-lg-5 right-pane p-4 p-lg-5">
        <div class="mx-auto login-card card">
          <div class="card-header">
            <h2 class="h5 text-dark mt-2 mb-0">Definir nova senha</h2>
            {% if validlink %}
              <p class="text-muted mt-2 mb-0">Olá, {{ form.user.get_full_name|default:form.user.username }}.</p>
            {% endif %}
          </div>
          <div class="card-body">
            {% if validlink %}
              {% if form.non_field_errors %}
                <div class="alert alert-danger alert-login mb-3" role="alert">{{ form.non_field_errors }}</div>
              {% endif %}
              <form method="post" novalidate>
                {% csrf_token %}
                <div class="form-floating mb-3">
                  <input type="password" class="form-control" id="id_new_password1" name="new_password1" placeholder="Nova senha" required>
                  <label for="id_new_password1">Nova senha</label>
                </div>
                {% if form.new_password1.errors %}
                  <div class="text-danger small mb-2">{{ form.new_password1.errors|striptags }}</div>
                {% endif %}

                <div class="form-floating mb-3">
                  <input type="password" class="form-control" id="id_new_password2" name="new_password2" placeholder="Confirme a nova senha" required>
                  <label for="id_new_password2">Confirme a nova senha</label>
                </div>
                {% if form.new_password2.errors %}
                  <div class="text-danger small mb-2">{{ form.new_password2.errors|striptags }}</div>
                {% endif %}

                <button type="submit" class="btn btn-primary w-100 py-2">Salvar senha</button>
              </form>
            {% else %}
              <div class="alert alert-warning">Este link não é mais válido. Solicite um novo link ao administrador.</div>
              <a class="btn btn-outline-primary" href="{% url 'login' %}">Ir para o login</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="login-copy">© 2025 JUMP Capital</div>
</section>
{% endblock %}

{% block footer %}{% endblock %}
